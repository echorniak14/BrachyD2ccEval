<!DOCTYPE html>
<html>
<head>
    <title>Brachytherapy Evaluation Report</title>
    <style>
        :root {
            --text-color: #333;
            --background-color: #fff;
            --header-color-1: #2a7ae2; /* Blue from the PDF */
            --header-color-2: #1e5aab; /* Darker blue from the PDF */
            --border-color: #ddd;
            --table-header-bg: #2a7ae2; /* Blue from the PDF */
            --table-header-text: white;
            --table-even-row-bg: #eaf2fa; /* Light blue from the PDF */
            --met-bg: #77dd77; /* Green from the PDF */
            --met-text: white;
            --not-met-bg: #ff6961; /* Red from the PDF */
            --not-met-text: white;
            --warning-bg: #fdfd96; /* Yellow from the PDF */
            --warning-text: black;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #f2f2f2;
                --background-color: #1a1a1a;
                --header-color-1: #3498db;
                --header-color-2: #6cb6ff;
                --border-color: #555;
                --table-header-bg: #2a7ae2;
                --table-header-text: #f2f2f2;
                --table-even-row-bg: #2c3e50;
                
            }
        }

        body { font-family: Arial, sans-serif; margin: 20px; color: var(--text-color); background-color: var(--background-color); }
        .logo { float: right; max-height: 80px; }
        h1 {
            color: var(--header-color-1);
            border-bottom: 2px solid var(--header-color-2);
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 28px;
        }
        h2 {
            color: var(--header-color-1);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 40px;
            font-size: 22px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            text-align: left;
        }
        th {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            font-weight: bold;
            text-transform: uppercase;
        }
        .no-transform {
            text-transform: none;
        }
        tbody tr:nth-child(even) { background-color: var(--table-even-row-bg); }
        
    </style>
</head>
<body>
    <img src="{{ logo_base64 }}" alt="Institution Logo" class="logo">
    <h1>Dose Summary</h1>
    <table style="width:100%; border: none; box-shadow: none;">
        <tr style="border: none;">
            <td style="width:50%; border: none; vertical-align: top;">
                <p><strong>Patient Name:</strong> {{ patient_name }}</p>
                <p><strong>Patient MRN:</strong> {{ patient_mrn }}</p>
                <br><br><br>
                <p><strong>EBRT Dose:</strong> {{ ebrt_dose }} Gy</p>
                <p><strong>EBRT Fractions:</strong> {{ ebrt_fractions }}</p>
            </td>
            <td style="width:50%; border: none; vertical-align: top; text-align: right;">
                <p><strong>Plan Name:</strong> {{ plan_name }}</p>
                <p><strong>Plan Date:</strong> {{ plan_date }}</p>
                <p><strong>Plan Time:</strong> {{ plan_time }}</p>
                <p><strong>Planned Source AKS:</strong> {{ source_info }}</p>
                <p><strong>Planned Dose per Fraction:</strong> {{ brachy_dose_per_fraction }} Gy</p>
                <p><strong>Number of Fractions:</strong> {{ number_of_fractions }}</p>
            </td>
        </tr>
    </table>

    <h2>Target Volume DVH Results</h2>
    <table>
        <thead>
            <tr>
                <th>Structure</th>
                <th class="no-transform">&#x3B1;/&#x3B2;</th>
                <th>Volume (cc)</th>
                <th>Dose Metric</th>
                {{ fraction_headers }}
                <th>EQD2 (Gy)</th>
            </tr>
        </thead>
        <tbody>
            {{ target_volume_rows }}
        </tbody>
    </table>

    <h2>OAR DVH Results</h2>
    <table>
        <thead>
            <tr>
                <th>Structure</th>
                <th class="no-transform">&#x3B1;/&#x3B2;</th>
                <th>Volume (cc)</th>
                <th>Dose Metric</th>
                {{ fraction_headers }}
                <th>EQD2 (Gy)</th>
            </tr>
        </thead>
        <tbody>
            {{ oar_rows }}
        </tbody>
    </table>

    <h2>Point Dose Results</h2>
    <table>
        <thead>
            <tr>
                <th>Point Name</th>
                <th class="no-transform">&#x3B1;/&#x3B2;</th>
                {{ fraction_headers }}
                <th>EQD2 (Gy)</th>
            </tr>
        </thead>
        <tbody>
            {{ point_dose_rows }}
        </tbody>
    </table>
</body>
</html>